<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title>抽奖</title>
    <link rel="stylesheet" href="./../css/base.css">
    <link rel="stylesheet" href="./../css/style.css">
</head>

<body id="lotto">
    <img class="bg" src="./../img/lotto_bg.png" alt="">
    <img src="./../img/bbb.png" alt="" class="bg_foot">
    <div class="content">
        <div class="main">
            <div>
                <img src="./../img/p1.png" alt="">
                <span>芒果TV会员</span>
                <em>（31天会员）</em>
            </div>
            <div>
                <img src="./../img/p2.png" alt="">
                <span>再接再厉</span>
            </div>
            <div>
                <img src="./../img/p3.png" alt="">
                <span>牛奶盒子</span>
            </div>
            <div class="ticket">
                <img src="./../img/p4.png" alt="">
                <span>快乐购券</span>
                <em>（30元）</em>
            </div>
            <div class="open">
                <img src="./../img/open.png" alt="" class="">
            </div>
            <div class="ticket ticket2">
                <img src="./../img/p5.png" alt="">
                <span>芒果综艺门票</span>
            </div>
            <div>
                <img src="./../img/p6.png" alt="">
                <span>充电宝</span>
            </div>
            <div>
                <img src="./../img/p1.png" alt="">
                <span>再接再厉</span>
            </div>
            <div>
                <img src="./../img/p7.png" alt="">
                <span>芒果TV会员</span>
                <em>（7天会员）</em>
            </div>
        </div>
        <footer>
            <span class="rule">业务规则</span>
            <span class="myPrizeBtn">我的奖品 </span>
        </footer>
    </div>
    <div class="pupop">
        <!-- 规则 -->
        <div class="p_rule">
            <img src="./../img/rule_bg.png" alt="" class="bbg">
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum laoreet. Proin gravida
                dolor sit amet lacus accumsan et viverra justo commodo. Proin sodales pulvinar tempor. Cum sociis
                naagnis dis parturient montes, nascetur ridiculus mus. Nam fermentum, nulla luctus pharetra vulputate,
                felis tellus mollis orci, sed rhoncus sapien nunc eget.
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum laoreet. Proin gravida
                dolor sit amet lacus accumsan et viverra justo commodo. Proin sodales pulvinar tempor. Cum sociis
                naagnis dis parturient montes, nascetur ridiculus
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum laoreet. Proin gravida
                dolor sit amet lacus accumsan et viverra justo commodo. Proin sodales pulvinar tempor. Cum sociis
                naagnis dis parturient montes, nascetur ridiculus mus. Nam fermentum, nulla luctus pharetra vulputate,
                felis tellus mollis orci, sed rhoncus sapien nunc eget.
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum laoreet. Proin gravida
                dolor sit amet lacus accumsan et viverra justo commodo. Proin sodales pulvinar tempor. Cum sociis
                naagnis dis parturient montes, nascetur ridiculus
            </p>
            <img src="./../img/ok1.png" alt="" class="ok">
            <img src="./../img/close.png" alt="" class="close">
        </div>
        <!-- 牛奶盒子 -->
        <div class="nor p_milk">
            <img src="./../img/milk_bg.png" alt="" class="bbg">
            <p>
                天降锦鲤！恭喜你抽中大奖！<br /> 芒果热门综艺门票一张 <br />（牛奶盒子）
            </p>
            <img src="./../img/ok2.png" alt="" class="ok">
            <span class="small">
                (奖品寄送地址为宝藏卡订单地址：江苏省南京市xx区xx小区)
            </span>
            <img src="./../img/close.png" alt="" class="close">
        </div>
        <!-- 芒果7天 -->
        <div class="nor p_mango7">
            <img src="./../img/milk_bg.png" alt="" class="bbg">
            <p>
                恭喜你抽中大奖！<br /> 芒果7天会员（快乐购满减券）
            </p>
            <img src="./../img/ok2.png" alt="" class="ok">
            <span class="small">
                （奖品兑换码将以短信的形式下发至您的宝藏卡 订单联系号码，请注意查收短信。）
            </span>
            <img src="./../img/close.png" alt="" class="close">
        </div>
        <!-- 未中奖 -->
        <div class="nor p_emtpy">
            <img src="./../img/empty_bg.png" alt="" class="bbg">
            <p>
                很遗憾 <br />你与大奖擦肩而过
            </p>
            <img src="./../img/ok3.png" alt="" class="ok">
            <img src="./../img/close.png" alt="" class="close">
        </div>
        <!-- 我的奖品 -->
        <div class="p_myLotto">
            <img src="./../img/myPrize_bg.png" class="myLotto_bg">
            <ul>
                <li>
                    <img src="./../img/prize1.png" alt="">
                </li>
                <li>
                    <img src="./../img/prize2.png" alt="">
                </li>
                <li>
                    <img src="./../img/prize3.png" alt="">
                </li>
            </ul>
            <p>
                若抽中牛奶盒子、门票等实物奖品，将在成功激活宝藏卡后发放；芒果会员以及快乐购满减券等奖品，将在订购成功后直接下发兑换券码至相应宝藏卡联系人手机号码。
            </p>
            <img src="./../img/ok4.png" alt="" class="ok">
            <img src="./../img/close.png" alt="" class="close">

        </div>
    </div>
</body>

</html>
<script src="./../js/rem.js"></script>
<script src="./../js/zepto.min.js"></script>
<script>
    $(function () {
        // 屏幕比较长的手机,底部添加背景图接上
        var bg = document.querySelector(".bg").offsetHeight
        var Wh = document.body.clientHeight
        var height = Wh - bg
        console.log('Wh', Wh, 'bg', bg, 'foot_height', height)
        if (height > 0) {
            if (height > 200) {
                height = 200
            }
            $('.bg_foot').css('height', height)
        }

        // 弹窗时,禁止页面滚动
        $('.pupop').on('touchmove', function (event) {
            if (event.target.className.indexOf('rule_docs') == -1) {
                event.preventDefault()
            }
        })


        /**
         * 调用这个方法 lottoFn ，传入参数，调整奖品项目
         * 奖品参数 名称 弹窗名称
         * 0 快乐购券 p_mango7
         * 1 再接再厉 p_emtpy
         * 2 牛奶盒子 p_milk
         * */
        // 抽奖
        $('.main').on('click', '.open', function () {
            // 测试代码
            if (!window.aaa) {
                window.aaa = 0
            }
            switch (window.aaa++) {
                case 0:
                    lottoFn(0)
                    break
                case 1:
                    lottoFn(1)
                    break
                case 2:
                    lottoFn(2)
                    window.aaa = 0
                    break
            }
        })

        // 打开活动规则
        $('.rule').click(function () {
            openPupop('p_rule')
        })
        // 打开我的奖品
        $('.myPrizeBtn').click(function () {
            openPupop('p_myLotto')
        })

        // 关闭弹窗
        $('.ok').click(function () {
            close()
        })
        // 关闭弹窗
        $('.close').click(function () {
            close()
        })

        // 打开弹窗方法
        function openPupop(name) {
            $('.pupop').show()
            $('.' + name).show()
        }

        // 关闭弹窗方法
        function close() {
            $('.pupop').hide()
            $('.pupop > div').hide()
        }

        // 抽奖的方法 @target 目标 j 旋转圈数
        function lottoFn(target, j = 2) {
            console.log('target',target)
            var i = 0
            $('.main div')[0].classList.add('avtive')
            var narmal = setInterval(function () {
                $('.main div').removeClass('avtive')
                    ++i
                switch (i) {
                    case 3:
                        $('.main div')[5].classList.add('avtive')
                        break;
                    case 4:
                        $('.main div')[8].classList.add('avtive')
                        break;
                    case 5:
                        $('.main div')[7].classList.add('avtive')
                        break;
                    case 7:
                        $('.main div')[3].classList.add('avtive')
                        break;
                    case 8:
                        i = 0
                        $('.main div')[0].classList.add('avtive')
                        j--
                        if (j == 0) {
                            clearInterval(narmal)
                            fn2()
                        }
                        break;
                    default:
                        $('.main div')[i].classList.add('avtive')
                }
            }, 100)

            function fn2() {
                var enterLotto = setInterval(function () {
                    $('.main div').removeClass('avtive')
                        ++i
                        // 改变转动的奖品格子
                    switch (i) {
                        case 3:
                            $('.main div')[5].classList.add('avtive')
                            break;
                        case 4:
                            $('.main div')[8].classList.add('avtive')
                            break;
                        case 5:
                            $('.main div')[7].classList.add('avtive')
                            break;
                        case 7:
                            $('.main div')[3].classList.add('avtive')
                            break;
                        case 8:
                            i = 0
                            $('.main div')[0].classList.add('avtive')
                        default:
                            $('.main div')[i].classList.add('avtive')
                    }
                    if (i == target) {
                        clearInterval(enterLotto)
                        var obj = {
                            0: 'p_mango7',
                            1: 'p_emtpy',
                            2: 'p_milk',
                        }
                        // 弹出中奖结果
                        setTimeout(() => {
                            openPupop(obj[target] || 'p_emtpy')
                        }, 500);
                    }
                }, 100)
            }
        }
    })
</script>